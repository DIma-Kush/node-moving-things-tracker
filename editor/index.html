<!DOCTYPE html>
<html>

<head>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    .tools {
      position: fixed;
      top: 5px;
      right: 5px;
    }
  </style>
</head>

<body>
  <canvas id="canvas" width="1920" height="1080"></canvas>
  <div class="tools">
    <button id="toJSON">toJSON</button>
    <button id="loadFromJSON">loadFromJSON</button>
    <button id="delete">delete</button>
    <button id="add">add dissapear</button>
    <button id="addignored">add ignored</button>
  </div>
  <script src="fabric.min.js"></script>
  <script>

    (function () {

      var canvas = this.__canvas = new fabric.Canvas('canvas');
      fabric.Object.prototype.transparentCorners = false;
      fabric.Image.fromURL('./firstframe.jpg', function (img) {
        var oImg = img.set({ left: 0, top: 0, selectable: false }).scale(1);
        canvas.add(oImg);
        canvas.sendBackwards(oImg);

      });

      function addBlueRectangle() {
        var blue = new fabric.Rect({
          top: 500, left: 500, width: 200, height: 200, opacity: 0.5, fill: 'blue'
        });
        canvas.add(blue)
        canvas.bringForward(blue)
      }

      function addRedRectangle() {
        var red = new fabric.Rect({
          top: 500, left: 500, width: 200, height: 200, opacity: 0.5, fill: 'red'
        });
        canvas.add(red)
        canvas.bringForward(red)
      }

      var $ = function (id) { return document.getElementById(id) };
      var toJSON = $('toJSON'),
        deleteBtn = $('delete'),
        addBlueBtn = $('add');
      addRedBtn = $('addignored');
      loadFromJSON = $('loadFromJSON');

      addBlueBtn.onclick = addBlueRectangle;
      addRedBtn.onclick = addRedRectangle;

      deleteBtn.onclick = function () {
        // debugger;
        canvas.remove(canvas.getActiveObject());
        // canvas.requestRenderAll();
      }

      toJSON.onclick = function () {
        var json = JSON.stringify(canvas.toJSON(['selectable']));
        console.log(json);
        console.log("DATA FOR TRACKER");
        var trackerData = canvas.toJSON().objects.filter((object) => object.type === "rect")
          .map((object) => {
            return {
              x: object.left,
              y: object.top,
              w: object.width * object.scaleX,
              h: object.height * object.scaleY
            }
          });
        console.log(JSON.stringify(trackerData));
        var trackerOtherFormatData = canvas.toJSON().objects.filter((object) => object.type === "rect")
          .map((object) => {
            return {
              xMin: object.left,
              yMin: object.top,
              xMax: object.left + object.width * object.scaleX,
              yMax: object.top + object.height * object.scaleY
            }
          });
        console.log(JSON.stringify(trackerOtherFormatData));
      }

      loadFromJSON.onclick = function () {
        json = '{"version":"2.0.0-beta7","objects":[{"type":"image","version":"2.0.0-beta7","originX":"left","originY":"top","left":0,"top":0,"width":1920,"height":1080,"fill":"rgb(0,0,0)","stroke":null,"strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"crossOrigin":"","cropX":0,"cropY":0,"selectable":false,"src":"http://localhost:8080/tracker/editor/average.jpg","filters":[]},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":371,"top":412,"width":200,"height":200,"fill":"blue","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":0.94,"scaleY":0.69,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":156,"top":970,"width":200,"height":200,"fill":"blue","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":2.38,"scaleY":0.57,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":960,"top":965,"width":200,"height":200,"fill":"blue","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":3.23,"scaleY":0.59,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":1580.14,"top":311.86,"width":200,"height":200,"fill":"blue","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":0.42,"scaleY":0.47,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":638,"top":1016.89,"width":200,"height":200,"fill":"red","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":0.32,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":1226,"top":347,"width":200,"height":200,"fill":"red","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":0.37,"scaleY":0.37,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":1266,"top":311,"width":200,"height":200,"fill":"red","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":0.42,"scaleY":0.42,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":1317.33,"top":284.33,"width":200,"height":200,"fill":"red","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":0.36,"scaleY":0.36,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":1371,"top":246,"width":200,"height":200,"fill":"red","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":0.35,"scaleY":0.35,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":1490.22,"top":-28.11,"width":200,"height":200,"fill":"red","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1.44,"scaleY":1.44,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true},{"type":"rect","version":"2.0.0-beta7","originX":"left","originY":"top","left":1759,"top":826,"width":200,"height":200,"fill":"red","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":0.5,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0,"selectable":true}]}';
        canvas.loadFromJSON(json);
      }


    })();
  </script>
</body>

</html>
